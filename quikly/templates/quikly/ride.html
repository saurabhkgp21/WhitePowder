<!DOCTYPE html>
<html>
  <head>
  {% load static %}
  <link rel="stylesheet" type="text/css" href="{% static 'quikly/ride.css' %}" />
  <link href="../../static/quikly/cycle_transparent.png" rel="icon">

  </head>
  <body>
    <h3>My Bing Maps Demo</h3>
    <div id="map"></div>
	<script type='text/javascript' src='https://www.bing.com/api/maps/mapcontrol?branch=release&callback=initMap' async defer></script>
    <script>
	
	function initMap() {
		alert({{cycles.count}})
      	if (navigator.geolocation){
			navigator.geolocation.getCurrentPosition( successFunction);
		} 

		else 
		{
			alert('It seems like Geolocation, which is required for this page, is not enabled in your browser. Please use a browser which supports it.');
			}
		
      }

    function successFunction(pos) {
		lat = pos.coords.latitude;
	    long = pos.coords.longitude;
		map = new Microsoft.Maps.Map(document.getElementById('map'), {
		    credentials: 'ApBC3uUFt_qROZ7IK1b5qlIxYpzlsMAx5kPHo4WUET36OGBO-4jFcwdEx2nRe8qS',
		    center: new Microsoft.Maps.Location(lat, long),
		    zoom: 17
		});
		
	    {% for cycle in cycles %}
	    	var Pin = new Microsoft.Maps.Pushpin(
	    		new Microsoft.Maps.Location({{cycle.latitude}},{{cycle.longitude}}),{
	    			icon: "{% static 'quikly/cycle_transparent.png' %}"
	    		});
	    	map.entities.push(Pin);
	    	// var userid = lenderPins[i].userid.toString();
			Microsoft.Maps.Events.addHandler(Pin, 'click', function() {
				window.location.href = "/cycle/" + "{{cycle.id}}";
			});
	    {% endfor %}

		var myLocationPin = new Microsoft.Maps.Pushpin(
	    	map.getCenter(), {color: 'blue'});
	    map.entities.push(myLocationPin);
	}
    </script>
  </body>
</html>